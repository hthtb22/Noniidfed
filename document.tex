\documentclass{article} 
\usepackage{amsmath,amsthm}     
\usepackage{graphicx}     
\usepackage{bbm}
\usepackage{hyperref} 
\usepackage{url}
\usepackage{amsfonts} 
\usepackage{multicol}
\usepackage{tikz}
\usepackage{tabularx}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage[ruled,vlined]{algorithm2e}
\DeclareMathOperator{\ReLu}{ReLU}
\DeclareMathOperator{\Avg}{Avg}
\DeclareMathOperator{\tridiag}{tridiag}
\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\arginf}{arg\,inf}
\usetikzlibrary{positioning,chains,fit,shapes,calc}
\theoremstyle{theorem}
\newtheorem{theorem}{Theorem}

\theoremstyle{definition}
\newtheorem*{definition}{Definition}
\newtheorem*{remark}{Remark}
\newtheorem{proposition}{Proposition}

\allowdisplaybreaks
\usepackage{collectbox}
\makeatletter
\newcommand{\mybox}{%
	\collectbox{%
		\setlength{\fboxsep}{1pt}%
		\fbox{\BOXCONTENT}%
	}%
}
\@addtoreset{footnote}{page}
\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
	\section{Non IID data}
	We formally introduce Federated Learning in the context of a $C-$class
	classification problem, which is defined over a compact feature
	space $X$ and a label space $Y = [C]$, where $[C]=\{1, \cdots , C.\}$
	Let $(x, y)$ denote a particular labeled sample. Let $f : X  \rightarrow S$ denote the prediction function, where $S=\{z | \sum_{i=1}^C z_i =1 , z_i \geq 0 \forall i \in [C]\}$. That is, the vector valued function $f$ yields a probability vector $z$ for each sample $x$, where $f_i$ predicts the probability that the sample belongs to the $i-$th class.\\
	Let the vector $w$ denote model weights. For classification,
	the commonly used training loss is cross entropy, defined as
	$$L(w) =\mathbb{E}_{x,y \sim p} [\sum_{i=1}^C \mathbbm{1}_{y=i} \log  f_i(x,w) ]=\sum_{i=1}^{C} p(y=i) \mathbb{E}_{x|y=i}[\log f_i(x,w)] $$
	The learning problem is to solve the following optimization
	problem:
	$$\min_{w} \sum_{i=1}^{C} p(y=i) \mathbb{E}_{x|y=i}[\log f_i(x,w)]$$
	\textbf{Why Non-IID data is a trouble?}
	Some recent works show that mose decentralized learning algorithms suffer from major model quality loss (or even divergence) when run on non-IID data partitions. However, it is interesting to note that BSP is robust to Non-IID data.\\
	It is shown that the accuracy may be affected by the exact data distribution, i.e. the skewness of data distribution. More specifically, the skewness can be roughly interpreted as the distance between the data distribution on each client and the population distribution. In addition, such distance can be evaluated with the earth mover's distance(EMD) between distributions. Based on experiment on real-world dataset, the test accuracy falls sharply with respect to EMD beyond certain threshold. 
	\section{Non Convex optimization on stochastic gradient descent methods}
	\subsection{Using local smoothness and maximal nondegeneracy}
	In general, we optimize the function $f: \mathbb{R^d} \to \mathbb{R}$ with respect to parameter $theta$ $$f(\theta)=\mathbb{E}[F(\theta,X)]$$ where $F: \mathbb{R}^d \times \mathbb{R}^m \to \mathbb{R}$, $\theta$ can be considered as a parameter vector, while $d,m$ are the dimension of the parameter and training examples (resp.). In the above problem,$F = \sum_{i=1}^C \mathbbm{1}_{y=i} \log  f_i(x,w)$. Let us denote $\mathcal{M} = \{\theta = \arginf f\}$ the set of minima of $f$.
	Assumptions:
	\begin{itemize}
		\item $\mathcal{M}$ is locally smooth.
		\item $f$ is locally three times continous differentiable on the local set of$\mathcal{M}$. And the Hessian matrix of $f$ is maximally non degenerate.
		\item 
	\end{itemize}
Initialization:
The initial data was sample from the bounded open set $A$ that contains at least one element in local set of $\mathcal{M}$.
Denote by $\theta_{0}^{k,M,r} : \Omega \to \mathbb{R}^d$ indicates $k$-th sample in the sampling set of size $K$, mini-batch size $M$, and parameter $r>0$ involving to learning parameter. The initial data is uniformly distributed on $A$. i.i.d and independent from $X_{k,m,n}$.\\
Weights update: $$\theta_{n}^{k,M,r}  =\theta_{n-1}^{k,M,r} -\frac{r}{n^{\rho} M} \left[\sum_{i=1}^{m} \nabla_{\theta}F(\theta_{n-1}^{k,M,r} , X_{k,n,m}) \right] $$
Mini-batch approximation:
$$F^{K, \mathfrak{M},n }(\theta , w)= \frac{1}{\mathfrak{M}} \sum_{i=1}^{\mathfrak{M}}  F \left( \theta,  X_{1,n+1,m} (w)\right)$$
$$\sum_{m=1}^{\mathfrak{M}}F \left(\theta_{n}^{K,M,\mathfrak{M},r} , X_{1,n+1,m}\right) =\min_{k \in [K]} \left[\sum_{m=1}^{\mathfrak{M}}F \left(\theta_{n}^{k,M,r} , X_{1,n+1,m}\right) \right]$$ 
Theorem: $$\begin{aligned}
&\mathbb{P}\left( \text{ Distance between} f(\theta_{n}^{k,M,\mathfrak{M},r}) \text{ and minima bigger than }\epsilon \right) \\ &= \mathbb{P}\left(  f(\theta_{n}^{k,M,\mathfrak{M},r}) - \inf_{\theta} f(\theta)\geq \epsilon \right) \\ &\leq \frac{cK}{\epsilon^2 \mathfrak{M}} + \left[ \kappa + c \left(\frac{1}{\epsilon^2 n ^{\rho}}+ \frac{n^{1-p}}{\sqrt{M}}\right)\right]^K \end{aligned}$$
 \subsection{Using decomposition of objective function}
 The problem is finding the optimum solution on the convex set $C$
 $$\min_{x \in C} f(x) = \min_{x \in C} \{ g(x)-h(x) \} $$
 Assumptions
 \begin{itemize}
 	\item $f$ is bounded below $C$
 	\item $h$ is continuous and convex
 	\item $g$ is continuous differentiable and $M_g$ smooth
 \end{itemize}
Algorithm
Initialization. Choose $x_0 \in \int(C)$ , level set of $x_0$ is in $C$.\\
Update: $x_{k+1}=x_{k} -\alpha (\nabla g(x_k)-u_k$ where $u_k$ is chosen randomly from $\partial h(x_k)$ and learning rate $\alpha \in \left[0, 1/M_g\right]$.\\
Theorem 
$f(x_k)$ is strictly decreasing and converges. The limit point is also a critical point of $f$. Moreover, for all $k$, $$\Avg \left(\left\|\nabla f(x_k)\right\|^2_2 \right) \leq \frac{2(f(x_0)-f^{*})}{\alpha (k+1)}$$
$$\min_{x \in C} f(x) = \min_{x \in C} g(x)-h(x)+ \varphi(x)$$
\subsection{Using extrapolation}
Problem $$\min_{x \in \mathbb{R}^d} f(x) = \min_{x \in  \mathbb{R}^d}  \mathbb{E}\left[f\left(x, \xi\right)\right]  $$
Assumption: \begin{itemize}
	\item $f(x)$ is $L-$smooth, that means  $$\left\|\nabla f(u)-\nabla f(v) \right\| \leq L \left \| u-v \right\|$$
	\item There exist $\Delta$ such that $f(x)-f(x_*) \leq \Delta$ for all $x \in \mathbb{R}^d$ where $x_*$ be the global minimum of $f(x)$
	\item (Bounded variance) $$\mathbb{E} \left[\| \nabla F(x, \xi)-\nabla f(x)\| ^2\right] \le G^2, \ \forall x, \xi $$	
\end{itemize}
\begin{algorithm}[H]
	\SetAlgoLined
	Initialization $z_0=x_0$ and $g_0=\dfrac{1}{m} \sum_{i=1}^{m} \nabla f(x_0, \xi_{i,0})$\;
	\For{each round $t=1,2, \cdots ,T$}{
		$x_t=z_{t-1}- \eta g_{t-1}$ \\
		$g_t=\dfrac{1}{m}\sum_{i=1}^{m} \nabla f(x_t, \xi_{i,t})$ \\
		$z_t=z_{t-1} -\eta g_t$
	} 
	\caption{Mini batch stochastic gradient descent with extrapolation (Mini-batch SGDE).}
\end{algorithm}
Theorem. Chosing the learning rate $\eta \le \frac{1}{12L}$ and 
$$\min_{t \in \{1, \cdots, T\}} \mathbb{E} \left[ \left\|\nabla f(x_t)\right\|^2 \right] \leq \dfrac{3L\eta G^2}{2T} +\dfrac{8(f(x_0)-f(x_*))}{\eta T}+\dfrac{72G^2}{m}-\dfrac{1}{\eta^2T} \sum_{0}^{T-1} \mathbb{E}\left[\left\|x_{t+1}-x_{t}\right\|^2\right]$$
\section{}
\begin{itemize}
	\item \textbf{$L-$ Lipschitz gradient}: Local objective functions $f_i$ are all $L-$ smooth: $$\left\|\nabla f_i(u)-\nabla f_i(v) \right\| \leq L \left \| u-v \right\|$$	Or it can be rewritten: $$f_i(u) \le f_i(v)+(u-v)^{T} \nabla f_i(v)+\frac{L}{2} \|u-v\|^2$$
	\item \textbf{Bounded variance} $$\mathbb{E} _{\xi_k \sim D_i} \left[\| \nabla F(w, \xi_k)-\nabla f_k(w)\| ^2\right] \le\sigma ^2, \ \forall k,w $$
	\item 	\textbf{Bounded gradient} $$\mathbb{E} _{\xi_k \sim D_i} \left[\| \nabla F(w, \xi_k)\| ^2\right] \le G^2, \ \forall k,w $$
\end{itemize}
\end{document}